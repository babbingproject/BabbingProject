<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>리뷰 상세보기</title>
<meta http-equiv="Content-type" content="text/html; charset=UTF-8">
<link rel="stylesheet"
	href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>
<body th:align="center">
	<h1>리뷰 글 상세</h1>
	<form th:action="@{updateReviewView}" method="post">
		<input id="reviewId" name="reviewId" type="hidden" th:value="${reviewView.reviewId}">
		<input id="userId" name="userId" type="hidden" th:value="${session['uservo'].userId}">
		<table th:align="center" border="1" th:cellpadding="0"
			th:cellspacing="0">
			<tr>
				<td bgcolor="oange" th:text="제목" width="80"></td>
				<!-- <td th:value="${joinReviewList.reviewRegistration.title}"></td> -->
				<td><input name="title" type="text"
					th:value="${reviewView.title}"></td>
			</tr>
			<tr>
				<td bgcolor="orange" th:text="작성자"></td>
				<!-- <td th:text="${joinReviewList.reviewRegistration.uservo.nickname}"></td> -->
				<td th:text="${reviewView.writer}"></td>
			</tr>
			<tr>
				<td bgcolor="orange" th:text="장점"></td>
				<!-- <td><textarea name="content" th:text="${joinReviewList.advantages}" rows="10" cols="40"></textarea></td> -->
				<td><textarea name="advantages"
						th:text="${reviewView.advantages}" rows="10" cols="40"></textarea></td>
			</tr>
			<tr>
				<td bgcolor="orange" th:text="단점"></td>
				<td><textarea name="disadvantages"
						th:text="${reviewView.disadvantages}" rows="10" cols="40"></textarea></td>
			</tr>
			<tr>
				<td bgcolor="orange" th:text="등록일"></td>
				<!-- <td th:text="${reviewView.writeDate}"></td> -->
				<td th:text="${#dates.format(reviewView.writeDate,'yyyy-MM-dd')}"></td>
			</tr>
			<tr>
				<td colspan="2" align="center"><input type="submit"
					value="리뷰 수정"></td>
			</tr>
		</table>
		
		<div>		
			<div>
				<ul>
				<!-- <li th:value="${commentList.contents}"> -->
				</ul>	  
<!-- 				<input type="text" name="nickName" id="newReplyWriter"> -->
			</div>
			<div>
				REPLY TEXT <input type="text" name="contents" id="newReplyText">
			</div>
			<button id="replyAddBtn">ADD REPLY</button>
	</div>
	</form>
	<script>
	function getAllList(){
		
		$.getJSON("/commentAll"+reviewId, function(data){
			console.log(data.length);
			
			$(data).each(
				function(){
				str +="<li data-rno='"+this.commentId+"' class='replyLi'>"
				+this.commentId + " : " +this.replytest
				+"</li>";
			});
			
		$("#replies").html(str);
		console.log(str)
		});
	}

	$(function(){
			$("#replyAddBtn").on("click", function(){ 
		
		var contents = $("#newReplyText").val();
		var reviewId = $("#reviewId").val();
		var userId = $("#userId").val();
		alert(reviewId);
		alert(userId);
		
		$.ajax({
			type: 'post',
			url: '/addComment',
			data: {
				contents: contents,
				reviewId: reviewId,
				userId: userId
			},
			success: function(result){
				if (result) {
					alert("등록 되었습니다");
				}else{
					alert("오류가 발생했습니다.");
				}
			}
		});
		
	});
	});

	</script>
	
	<!-- <div>
		<form class="comment-write" action="/answer/register/{{q_id}}"
			method="post">
			답글쓰기:
			<textarea name="content"></textarea>
			<br> <br>
			<input type="hidden" value="{{q_id}}">
			<input type="submit" value="확인">
		</form>
	</div>
	<script>
		$.(".comment-write input[type=submit]").click(addComment);
		
		function addComment(e){
			console.log("click me");
			e.preventDefault();
			
			var queryString =$(".comment-write").serialize();
			console.log("query: "+queryString);
			
			var url = $("comment-write").attr("action");
			console.log("url: "+url);
			
			$.ajax({
				type: 'post',
				url: url,
				data: queryString,
				dataType: 'json',
				error: onError,
				success: onSuccess
			});			
		}
		
		
		function onError(){
			
			
		}
		
		function onSuccess(data, status){
			console.log(data);
			var commentTemplate = $("#commentTemplate").html();
			var template = commentTemplate.format(data.writer.userId, data.content, data.id, data.id);
			$.("commentList").append(template);
			$("textarea[name=content]").val("");			
		}
		
		String.prototype.format= function (){
			var args = arguments;
			return this.replace(/{(\d+)}/g, function(match, number){
				return typeof args[number] !='undefined'
				? args[number]
				: match
				;
				
			});
			
		};
		
		
		
	</script>
	<div class="commentList">
		{{#comments}}
		<article>
			<div>
				<div>
					<div>답변자 : {{uservo.nickname}}</div>
					<div>내용 : {{contents}}</div>
				</div>
			</div>
			<div>
				<ul>
					<li>
						<a href="@{/commentModify}">수정</a>
					</li>
					<li>
						<form action="@{/commentDelete}" method="POST">
							<input type="hidden" name="_name" value="DELETE">
							<button type="submit">삭제</button>
						</form>
					</li>
				</ul>
			</div>		
		</article>
		{{/answers}}
	</div> -->
	
	
				
</body>

</html>
